<!DOCTYPE html>
<html>
<head>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <style>
    body, html { margin: 0; padding: 0; overflow: hidden; font-family: Arial; }
    #ar-login-overlay {
      position: fixed; top: 0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center;
      z-index: 9999; transition: opacity 0.5s;
    }
    #ar-login-overlay.hidden { opacity:0; pointer-events:none; display:none; }
    .ar-login-box { background:#111; padding:20px; border-radius:12px; text-align:center; width: 80%; max-width: 400px; }
    input { width:100%; padding:10px; margin:10px 0; border-radius:6px; border:none; }
    button { width:100%; padding:10px; border:none; border-radius:6px; font-weight:bold; cursor:pointer; background:#0ff; color:#000; }
    #ar-status-text { margin-top:10px; font-size:14px; color:#fff; }
  </style>
</head>
<body>
  <!-- Overlay for login -->
  <div id="ar-login-overlay">
    <div class="ar-login-box">
      <h2>AR Login</h2>
      <input type="text" id="ar-username" placeholder="Username" />
      <input type="password" id="ar-password" placeholder="Password" />
      <button id="login-btn">Login</button>
      <p id="ar-status-text">Connecting...</p>
    </div>
  </div>

  <!-- AR Scene -->
  <a-scene vr-mode-ui="enabled:false" loading-screen="enabled:false"
           arjs="sourceType: webcam; debugUIEnabled: false;" embedded>
    <a-marker type="pattern" url="marker.patt" id="markerA">
      <a-box position="0 0.5 0" rotation="0 45 0" color="#4CC3D9"></a-box>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const overlay = document.getElementById('ar-login-overlay');
    const statusText = document.getElementById('ar-status-text');
    const loginBtn = document.getElementById('login-btn');
    const usernameInput = document.getElementById('ar-username');
    const passwordInput = document.getElementById('ar-password');

    const WS_URL = "wss://your-backend.example/ws"; // <-- replace with your backend
    let socket;

    function updateStatus(msg, color="#fff") {
      statusText.textContent = msg;
      statusText.style.color = color;
      console.log("[AR Scene]", msg);
    }

    function hideOverlay() {
      overlay.classList.add('hidden');
      setTimeout(() => overlay.style.display = 'none', 500);
    }

    function connectWS() {
      socket = new WebSocket(WS_URL);

      socket.addEventListener("open", () => {
        updateStatus("Connected. Enter credentials.");
      });

      socket.addEventListener("message", (event) => {
        try {
          const data = JSON.parse(event.data);
          if(data.type === "LOGIN_SUCCESS") {
            updateStatus(`Welcome, ${data.username}`, "lightgreen");
            hideOverlay();
          } else if(data.type === "LOGIN_FAILED") {
            updateStatus("Login failed. Try again.", "red");
          }
        } catch(err) {
          console.error("[AR Scene] Invalid message:", event.data);
        }
      });

      socket.addEventListener("close", () => {
        updateStatus("Disconnected. Reconnecting...", "orange");
        setTimeout(connectWS, 3000);
      });

      socket.addEventListener("error", (err) => {
        updateStatus("WebSocket error", "red");
        console.error(err);
        socket.close();
      });
    }

    loginBtn.addEventListener("click", () => {
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();
      if(!username || !password) {
        updateStatus("Enter username & password", "orange");
        return;
      }
      // Send login payload instantly
      socket.send(JSON.stringify({ type:"LOGIN", username, password }));
      updateStatus("Logging in...");
    });

    connectWS();
  </script>
</body>
</html>
