<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AR Login</title>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin:0; overflow:hidden; font-family:sans-serif; }
    #login-box {
      position: absolute; top:10%; left:50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.8); color:white; padding:20px; border-radius:10px;
      display: none;
    }
    #login-box input { display:block; margin:5px 0; padding:5px; width:200px; }
    #login-box button { margin:5px; padding:5px 10px; cursor:pointer; }
    #status { margin-top:5px; }
  </style>
</head>
<body>
  <div id="login-box">
    <h3>AR Login/Register</h3>
    <input type="text" id="username" placeholder="Username"/>
    <input type="password" id="password" placeholder="Password"/>
    <button onclick="loginUser()">Login</button>
    <button onclick="registerUser()">Register</button>
    <div id="status"></div>
  </div>

  <a-scene vr-mode-ui="enabled:false" embedded arjs>
    <a-marker preset="hiro" id="ar-marker"></a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const BACKEND = "https://additions-johnny-factory-dozen.trycloudflare.com";
    const loginBox = document.getElementById("login-box");
    const statusDiv = document.getElementById("status");

    document.querySelector("#ar-marker").addEventListener("markerFound", () => {
      loginBox.style.display = "block";
    });
    document.querySelector("#ar-marker").addEventListener("markerLost", () => {
      loginBox.style.display = "none";
    });

    async function loginUser(){
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      statusDiv.textContent = "Logging in...";
      try{
        const res = await fetch(`${BACKEND}/login`, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({username,password})
        });
        const data = await res.json();
        if(res.ok && data.token){
          statusDiv.textContent = "Login successful!";
        } else {
          statusDiv.textContent = data.detail || "Login failed";
        }
      } catch(err){
        statusDiv.textContent = "Login error";
        console.error(err);
      }
    }

    async function registerUser(){
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      statusDiv.textContent = "Registering...";
      try{
        const res = await fetch(`${BACKEND}/register`, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({username,password})
        });
        const data = await res.json();
        if(res.ok){
          statusDiv.textContent = "Registered! Logging in...";
          await loginUser();
        } else {
          statusDiv.textContent = data.detail || "Registration failed";
        }
      } catch(err){
        statusDiv.textContent = "Registration error";
        console.error(err);
      }
    }
  </script>
</body>
</html>
